<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hengzhi.dao.ManagerPaperDao">
<resultMap id="UnChangePapers" type="com.hengzhi.dto.ManagerPaper.UnChangePapers">
    <id property="paperId" column="paper_id"/>
    <result property="beginTime" column="begin_time"/>
    <result property="deadLine" column="end_time"/>
    <result property="paperName" column="name"/>
    <result property="score" column="score"/>
    <collection property="unChangeUserList" ofType="com.hengzhi.dto.ManagerPaper.UnChangeUser">
        <id property="paperId" column="paper_id"/>
        <result property="whetherCorrect" column="whether_correct"/>
    </collection>
</resultMap>

    <resultMap id="ChangePapers" type="com.hengzhi.dto.ManagerPaper.ChangePapers">
        <id property="paperId" column="paper_id"/>
        <result property="beginTime" column="begin_time"/>
        <result property="deadLine" column="end_time"/>
        <result property="paperName" column="name"/>
        <result property="totalNumber" column="number"/>
        <collection property="unChangeUserList" ofType="com.hengzhi.dto.ManagerPaper.UnChangeUser">
            <id property="paperId" column="paper_id"/>
            <result property="whetherCorrect" column="whether_correct"/>
        </collection>
    </resultMap>
    <resultMap id="UnFinishPapers" type="com.hengzhi.dto.ManagerPaper.UnFinishPapers">
        <id property="paperId" column="paper_id"/>
        <result property="beginTime" column="begin_time"/>
        <result property="deadLine" column="end_time"/>
        <result property="paperName" column="name"/>
        <result property="code" column="code"/>
        <result property="description" column="description"/>
    </resultMap>
    <resultMap id="ScoreInformation" type="com.hengzhi.dto.ManagerPaper.ScoreInformation">
        <result property="userId" column="user_id"/>
        <result property="score" column="score"/>
        <result property="paperId" column="paper_id"/>
        <result property="whetherCorrect" column="whether_correct"/>
        <collection property="userScoreInformationList" ofType="com.hengzhi.dto.ManagerPaper.UserScoreInformation">
            <id property="userId" column="user_id"/>
            <result property="name" column="name"/>
        </collection>
    </resultMap>

<!--    待改试卷数据-->
    <select id="selectUnChange" resultMap="UnChangePapers">
        select *
        from papers as p
        join user_paper as up
        where p.paper_id = up.paper_id
        and up.whether_correct = 0
    </select>
    <select id="selectUnChangeNumber" resultType="int">
        select count(*)
        from user_paper
        where whether_correct = 0
    </select>

<!--    已改试卷数据-->
    <select id="selectChange" resultMap="ChangePapers">
        select *
        from papers as p
        join user_paper as up
        where p.paper_id = up.paper_id
        and up.whether_correct = 1
    </select>
<!--未考试试卷信息-->
    <select id="selectUnFinish" resultMap="UnFinishPapers">
        select *
        from papers
        where begin_time &lt;&gt; NOW();
    </select>

<!--试卷成绩信息-->
    <select id="selectScoreInformation" resultMap="ScoreInformation">
        select *
        from user_paper as u
        join user
        where paper_id = #{paperId}
        and u.user_id = user.user_id
        and whether_correct = 1
    </select>
    <!--计算每一张试卷的总分-->
    <select id="selectSumScore" resultType="int">
        select sum(score)
        from user_paper
        where paper_id = #{paperId}
        and whether_correct = 1
    </select>
    <!--计算考试人数-->
    <select id="selectSumPeople" resultType="int">
        select count(score)
        from user_paper
        where paper_id = #{paperId}
        and whether_correct = 1
    </select>

<!--   修改未考试试卷信息 -->
    <update id="unTestPaper" parameterType="com.hengzhi.dto.ManagerPaper.UnTestPaper">
        update papers
        set `name`=#{paperName},`begin_time`=#{beginTime},`end_time`=#{deadLine},`description`=#{description}
        where paper_id=#{paperId}
    </update>
</mapper>